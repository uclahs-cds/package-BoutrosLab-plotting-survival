<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="A utility function that makes a pretty Kaplan-Meier survival curve given survival data and patient grouping. This is a highly general function that does very little with the survival data itself."><title>Utility function to make complete Kaplan-Meier plots — create.km.plot • BoutrosLab.plotting.survival</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Utility function to make complete Kaplan-Meier plots — create.km.plot"><meta property="og:description" content="A utility function that makes a pretty Kaplan-Meier survival curve given survival data and patient grouping. This is a highly general function that does very little with the survival data itself."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BoutrosLab.plotting.survival</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.10</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Utility function to make complete Kaplan-Meier plots</h1>
      
      <div class="d-none name"><code>create.km.plot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A utility function that makes a pretty Kaplan-Meier survival curve given survival data and patient grouping. This is a highly general function that does very little with the survival data itself.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">create.km.plot</span><span class="op">(</span></span>
<span>  <span class="va">survival.object</span>, </span>
<span>  patient.groups <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  filename <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  xat <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  yat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  xlimits <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  ylimits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.03</span><span class="op">)</span>,</span>
<span>  xaxis.cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  yaxis.cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  xlab.label <span class="op">=</span> <span class="st">'Time (Months)'</span>,</span>
<span>  xlab.cex <span class="op">=</span> <span class="fl">2.75</span>,</span>
<span>  ylab.label <span class="op">=</span> <span class="st">'Estimated Proportion'</span>,</span>
<span>  ylab.cex <span class="op">=</span> <span class="fl">2.75</span>,</span>
<span>        xaxis.fontface <span class="op">=</span> <span class="st">'bold'</span>,</span>
<span>        yaxis.fontface <span class="op">=</span> <span class="st">'bold'</span>,</span>
<span>  risk.labels <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  key.groups.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">patient.groups</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  key.groups.cex <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  risk.label.pos <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  risk.label.fontface <span class="op">=</span> <span class="st">'bold'</span>,</span>
<span>  key.groups.title <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  key.groups.title.cex <span class="op">=</span> <span class="fl">1.4</span>,</span>
<span>  key.stats.cex <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  explicit.HR.label <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  main <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  main.cex <span class="op">=</span> <span class="fl">3.0</span>,</span>
<span>  covariates <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stratification.factor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stratification.value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  censoring.pch.cex <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  line.colours <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  statistical.method <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  predefined.p <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predefined.hr <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predefined.hr.ci <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predefined.p.statistic.type <span class="op">=</span> <span class="st">'P'</span>,</span>
<span>  ph.assumption.check <span class="op">=</span> <span class="st">"warning"</span>,</span>
<span>  cox.zph.threshold <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>  cox.zph.truncation.thresholds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  show.key.groups <span class="op">=</span> <span class="cn">NA</span>, </span>
<span>  show.risktable <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  risktable.fontsize <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  key.groups.corner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>  key.groups.x.pos <span class="op">=</span> <span class="fl">0</span>, </span>
<span>  key.groups.y.pos <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span>  key.stats.corner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>  key.stats.x.pos <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  key.stats.y.pos <span class="op">=</span> <span class="fl">0.01</span>, </span>
<span>  ylab.axis.padding <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  bottom.padding <span class="op">=</span> <span class="fl">2</span>,  </span>
<span>  top.padding <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  right.padding <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  left.padding <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  return.statistics <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">7</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">7</span>, </span>
<span>  style <span class="op">=</span> <span class="st">'BoutrosLab'</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">1000</span>, </span>
<span>  size.units <span class="op">=</span> <span class="st">'in'</span>, </span>
<span>  enable.warnings <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  description <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use.legacy.settings <span class="op">=</span> <span class="cn">FALSE</span> </span>
<span>  <span class="op">)</span>;</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>survival.object</dt>
<dd><p>An object of class Surv -- patient ordering needs to be identical as for patient.groups</p></dd>

  <dt>patient.groups</dt>
<dd><p>Factor vector representing the grouping of patients.  The first level of the factor is the baseline risk group, used if 'cox' is selected for statistical method.  Note that even if statistical.method = NA, cox method may be selected by the function, so a judicious choice should be made.  If patient.groups is not a factor, it is coerced into a factor variable, and the baseline risk group is taken to be the risk group that comes first alpha-numerically.  In the plot, the baseline risk group appears first in the risk table and in the legend, and its Kaplan-Meier estimate is plotted in blue.  To plot survival curves for a subset of the groups in a factor, only specifies the desired groups in the "levels" argument of factor.</p></dd>

  <dt>filename</dt>
<dd><p>The filename to be written</p></dd>

  <dt>xat</dt>
<dd><p>A vector listing the points at which x-axis labels should be drawn</p></dd>

  <dt>yat</dt>
<dd><p>A vector listing the points at which y-axis labels should be drawn.  Defaults to seq(0,1,0.2)</p></dd>

  <dt>xlimits</dt>
<dd><p>A two component vector listing the upper and lower bounds of the x-axis (time dimension)</p></dd>

  <dt>ylimits</dt>
<dd><p>A two component vector listing the upper and lower bounds of the y-axis.  Defaults to c(0,1.03)</p></dd>

  <dt>xaxis.cex</dt>
<dd><p>Size of x-axis scales, defaults to 2</p></dd>

  <dt>yaxis.cex</dt>
<dd><p>Size of y-axis scales, defaults to 2</p></dd>

  <dt>xlab.label</dt>
<dd><p>X Axis Title</p></dd>

  <dt>xlab.cex</dt>
<dd><p>Size of x-axis labels, defaults to 2.75</p></dd>

  <dt>ylab.label</dt>
<dd><p>Y Axis Title.  Defaults to "Proportion", but should be customized to better describe survival outcome of interest.</p></dd>

  <dt>ylab.cex</dt>
<dd><p>Size of y-axis labels, defaults to 2.75</p></dd>

  <dt>xaxis.fontface</dt>
<dd><p>font face of the xaxis, defaults to bold</p></dd>

  <dt>yaxis.fontface</dt>
<dd><p>font face of the yaxis, defaults to bold</p></dd>

  <dt>risk.labels</dt>
<dd><p>A character vector that gives the labels for risk groups in risk table.  Defaults to full name of each risk group if there is more than one risk group, and to a blank string otherwise.  Useful to replace long names by shorter ones.)</p></dd>

  <dt>key.groups.labels</dt>
<dd><p>A character vector that gives the labels in the legend (listing name and line colour for each group).  Defaults to full name of risk groups.  Useful to replace long names by shorter ones.</p></dd>

  <dt>key.groups.cex</dt>
<dd><p>Size of key groups text</p></dd>

  <dt>risk.label.pos</dt>
<dd><p>A value for the x-axis position of the risk labels (in the risk table below the KM plot).  This value will typically be negative, in order for it to appear to the left of the value '0' on the x axis.</p></dd>

  <dt>risk.label.fontface</dt>
<dd><p>font face of the risk group label.  Defaults to 'bold'.  Set it to NULL if plain font face is wanted for risk group label.</p></dd>

  <dt>key.groups.title</dt>
<dd><p>Title for legend listing group names and line colours.  Defaults to NULL.</p></dd>

  <dt>key.groups.title.cex</dt>
<dd><p>Font size of title for legend listing group names and line colours.  Defaults to 2.2 (default cex for group names is 2).</p></dd>

  <dt>key.stats.cex</dt>
<dd><p>Font size of the statisitcal results key. Defaults to 1.5</p></dd>

  <dt>explicit.HR.label</dt>
<dd><p>If TRUE, prints the label for the comparison risk group in subscript to HR.  Only has an effect if the cox statistical method is used.  Defaults to TRUE.</p></dd>

  <dt>main</dt>
<dd><p>The main title for the plot (space is reclaimed if NULL)</p></dd>

  <dt>main.cex</dt>
<dd><p>Size of text for main plot title</p></dd>

  <dt>covariates</dt>
<dd><p>A data-frame (or matrix?) of variables to be controlled in the Cox model. If null, no adjustment is done.  No interactions are fit.</p></dd>
  
  <dt>stratification.factor</dt>
<dd><p>If building a cox model for statistical analysis purposes, the resulting cox model will be stratified on stratification.factor (if it is non-NULL).  User needs to provide a factor vector to specify stratification.factor Defaults to NULL.</p></dd>

  <dt>stratification.value</dt>
<dd><p>A pre-determined value to split the stratification factor (i.e. strata(stratification.factor &gt; stratification.value))</p></dd>

  <dt>lwd</dt>
<dd><p>Specifies line width, defaults to 2.5</p></dd>

  <dt>lty</dt>
<dd><p>Specifies line type, defaults to 1</p></dd>

  <dt>censoring.pch.cex</dt>
<dd><p>Specifies length of tick marks indicating censoring events, defaults to 1.1</p></dd>

  <dt>digits</dt>
<dd><p>How many decimal places of precision should be shown in printed survival statistics</p></dd>

  <dt>line.colours</dt>
<dd><p>A vector of colours to be used in plotting.  Defaults to the survival palette in BoutrosLab.plotting.general::default.colours</p></dd>

  <dt>statistical.method</dt>
<dd><p>A string indicating what statistical test should be done ('cox', 'logrank', 'ttest', 'none'). If NA, tries to choose intelligently</p></dd>

  <dt>predefined.p</dt>
<dd><p>A predefined p value (e.g. from a log likelihood test) to display on the plot IN PLACE OF any other statistical test (above)</p></dd>

  <dt>predefined.hr</dt>
<dd><p>A predefined hazard ratio value to display on the plot IN PLACE OF the hazard ratio calculated from a cox test.This value will only be displayed if the cox test is used. If the user provides a predefined hazard ratio, then they MUST specify a confidence interval (see predefined.hr.ci)</p></dd>

  <dt>predefined.hr.ci</dt>
<dd><p>A vector of two numeric values representing the boundaries of the confidence interval associated with the predefined hazard ratio. This vector should only be provided if a predefined hazard ratio is specified.</p></dd>

  <dt>predefined.p.statistic.type</dt>
<dd><p>String giving the type of predefined p-value statistic to be displayed. Passed directly to display.statistical.result function in BPG. Defaults to 'P'.</p></dd>

  <dt>ph.assumption.check</dt>
<dd><p>A string indicating how the result of the Proportional Hazards assumption check (using the cox.zph function) should be reported.  If "warning", a warning is printed on the plot if the pvalue of cox.zph is smaller than cox.zph.threshold.  If "warning.and.plot", a warning is printed on the plot and a Schoenfeld residual plot is produced and saved if the pvalue is smaller than cox.zph.threshold.  If "logrank", the statistical method is changed to logrank if the pvalue is smaller than cox.zph.threshold.  If "residual.plot", the Schoenfled residual plot is produced and saved as a tiff, no matter what the results of the cox.zph test are.  If "ignore", the cox.zph test is not performed at all.  Defaults to "warning".</p></dd>

  <dt>cox.zph.threshold</dt>
<dd><p>Numeric value, between 0 and 1).  If the pvalue of the cox.zph test is smaller than cox.zph.threshold, warnings will be provided to the user, indicating that the PH assumption may not be valid.  Defaults to 0.1</p></dd>

  <dt>cox.zph.truncation.thresholds</dt>
<dd><p>If ph.assumption.check is not 'ignore', and a variable fails the CPH assumption, a multi-point table will be generated with CPH results for all variables at multiple time points. The truncation points specified here, indicate the time points at which to split the survival data. See BoutrosLab.statistics.general/R/multi.point.HR.table.R</p></dd>

  <dt>show.key.groups</dt>
<dd><p>Defaults to FALSE if there is only one risk group, to TRUE otherwise</p></dd>

  <dt>show.risktable</dt>
<dd><p>Defaults to TRUE if there are optimal display values listed for the corresponding number of risk groups in the optimal.risktable.parameters.txt file in the inst directory (currently for 1 to 10 risk groups).  Otherwise, defaults to FALSE.</p></dd>

  <dt>risktable.fontsize</dt>
<dd><p>font size of the risk group table. Defaults to optimal.risktable.parameters.</p></dd>

  <dt>key.groups.corner</dt>
<dd><p>A two-component vector specifiying which corner of the groups key will be anchored by key.groups.x.pos and key.groups.y.pos.  Defaults to c(0,0), i.e. bottom left corner.</p></dd>

  <dt>key.groups.x.pos</dt>
<dd><p>Specifies the x position of the groups key (on scale of 0-1).  Defaults to 0</p></dd>

  <dt>key.groups.y.pos</dt>
<dd><p>Specifies the y position of the groups key (on scale of 0-1).  Defaults to 0.01</p></dd>

  <dt>key.stats.corner</dt>
<dd><p>A two-component vector specifying which corner of the statistical results key will be anchored by key.stats.x.pos and key.stats.y.pos.  Defaults to c(1,0), i.e. bottom right corner.</p></dd>

  <dt>key.stats.x.pos</dt>
<dd><p>Specifies the x position of the statistical results key (on scale of 0-1).  Defaults to 1</p></dd>

  <dt>key.stats.y.pos</dt>
<dd><p>Specifies the y position of the statistical results key (on scale of 0-1).  Defaults to 0.01</p></dd>

  <dt>ylab.axis.padding</dt>
<dd><p>A number specifying the distance of ylabel to the y-axis, defaults to 1.  This parameter (along with left.padding) can be changed to make more space to display long group names in the risk table.</p></dd>

  <dt>bottom.padding</dt>
<dd><p>A number specifying the distance to the bottom margin, defaults to 0.7</p></dd>

  <dt>top.padding</dt>
<dd><p>A number specifying the distance to the top margin, defaults to 0.1</p></dd>

  <dt>right.padding</dt>
<dd><p>A number specifying the distance to the right margin, defaults to 0.1</p></dd>

  <dt>left.padding</dt>
<dd><p>A number specifying the distance to the left margin, defaults to 0.5.  This parameter (along with ylab.axis.padding) can be changed to make more space to display long group names in the risk table.</p></dd>

  <dt>return.statistics</dt>
<dd><p>If TRUE, function will return a list containing trellis object (or 0/1 indicator) and relevant statistics.  If FALSE, no statistics are returned.  Defaults to FALSE.</p></dd>

  <dt>height</dt>
<dd><p>Figure height in size.units</p></dd>

  <dt>width</dt>
<dd><p>Figure width in size.units</p></dd>

  <dt>style</dt>
<dd><p>defaults to “BoutrosLab”, also accepts “Nature”, which changes parameters according to Nature formatting requirements</p></dd>

  <dt>resolution</dt>
<dd><p>Figure resolution in dpi</p></dd>

  <dt>size.units</dt>
<dd><p>Units of size for the figure</p></dd>

  <dt>enable.warnings</dt>
<dd><p>Print warnings if set to TRUE, defaults to TRUE</p></dd>

  <dt>description</dt>
<dd><p>short description of image/plot; defaults to null</p></dd>

  <dt>use.legacy.settings</dt>
<dd><p>boolean to set wheter or not to use legacy mode settings (font)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If return.stats is TRUE: if <code>filename</code> is <code>NULL</code> then returns the trellis object, otherwise creates a plot and returns a 0/1 success code.  If return.stats is FALSE: returns a list whose first element is the trellis object if <code>filename</code>) is <code>NULL</code>, 0/1 otherwise, and whose other elements are relevent statistics.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Nathalie Moon</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="make.survival.plot.html">make.survival.plot</a></code>,<code><a href="make.survfit.plot.html">make.survfit.plot</a></code>,<code>create.scatterplot</code>, <code><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></code>, <code><a href="https://rdrr.io/pkg/lattice/man/Lattice.html" class="external-link">lattice</a></code> for an overview of the package.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">75</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">99</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survobj</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">survtime</span>, <span class="va">survstat</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">two.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'B'</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">three.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'B'</span>, <span class="fl">50</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'C'</span>, <span class="fl">50</span><span class="op">)</span> <span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set some plotting parameters</span></span></span>
<span class="r-in"><span><span class="va">xlimits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">xat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">25</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># simple survival plot with 2 risk groups</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="va">two.groups</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"simple.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled A will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue for the following factors: groups, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.The cox.zph test yielded a small pvalue for the following factors: GLOBAL, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>SEE BELOW FOR MULTI-POINT HR TABLE:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  1 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in solve.default(imat, u):</span> Lapack routine dgesv: system is exactly singular: U[2,2] = 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># survival plot with 2 risk groups, group B specified as reference group for cox analysis</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">two.groups</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="st">"A"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"simple.survival.plot2.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled B will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue for the following factors: groups, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.The cox.zph test yielded a small pvalue for the following factors: GLOBAL, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>SEE BELOW FOR MULTI-POINT HR TABLE:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  1 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in solve.default(imat, u):</span> Lapack routine dgesv: system is exactly singular: U[2,2] = 0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># survival plot for single group</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"single.group.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># survival plot with three risk groups, customized (longer) group names</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="va">three.groups</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"three.group.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  key.groups.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group A"</span>,<span class="st">"Group B"</span>,<span class="st">"Group C"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  risk.labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"First Group"</span>,<span class="st">"Second Group"</span>,<span class="st">"Third Group"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  ylab.axis.padding <span class="op">=</span> <span class="fl">3.5</span>,</span></span>
<span class="r-in"><span>  left.padding <span class="op">=</span> <span class="fl">3.5</span>,</span></span>
<span class="r-in"><span>  risk.label.pos <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Creating data for six groups</span></span></span>
<span class="r-in"><span><span class="va">survtime.six.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">75</span>, <span class="fl">105</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">99</span>, <span class="fl">105</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survstat.six.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">35</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survobj.six.groups</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">survtime.six.groups</span>, <span class="va">survstat.six.groups</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">six.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'B'</span>,<span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'C'</span>,<span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'D'</span>,<span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'E'</span>,<span class="fl">35</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'F'</span>,<span class="fl">35</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>, </span></span>
<span class="r-in"><span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span>,<span class="st">'C'</span>,<span class="st">'D'</span>,<span class="st">'E'</span>,<span class="st">'F'</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with six risk groups, legend and statistical results in </span></span></span>
<span class="r-in"><span><span class="co"># different locations</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.six.groups</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="va">six.groups</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"simple.survival.plot.six.groups.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  key.stats.corner <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="co"># bottom left corner selected</span></span></span>
<span class="r-in"><span>  key.stats.x.pos <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  key.stats.y.pos <span class="op">=</span> <span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>  key.groups.x.pos <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>  key.groups.y.pos <span class="op">=</span> <span class="fl">0.09</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Colour scheme may not be greyscale compatible.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Merge levels of a factor and then plot </span></span></span>
<span class="r-in"><span><span class="va">survtime.stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">99</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">85</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">55</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survstat.stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survobj.stage</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">survtime.stage</span>, <span class="va">survstat.stage</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">groups.stage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'I'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'II'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'III'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'IV'</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'I'</span>,<span class="st">'II'</span>,<span class="st">'III'</span>,<span class="st">'IV'</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with 4 risk groups, one for each stage</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.stage</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="va">groups.stage</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"stage.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Colour scheme may not be greyscale compatible.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># merge stages I and II together, and stages II and III together by defining</span></span></span>
<span class="r-in"><span><span class="co"># new levels for the factor variables</span></span></span>
<span class="r-in"><span><span class="va">merged.stage.groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups.stage</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">merged.stage.groups</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  low.stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>,<span class="st">"II"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  high.stage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"III"</span>,<span class="st">"IV"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with merged stage groups</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.stage</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="va">merged.stage.groups</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"merged.stage.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  left.padding <span class="op">=</span> <span class="fl">1.5</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled low.stage will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue for the following factors: groups, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.The cox.zph test yielded a small pvalue for the following factors: GLOBAL, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>SEE BELOW FOR MULTI-POINT HR TABLE:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          n      wald.p global.ph.p  group_HR group_CI95l group_CI95h</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5  400 0.024210342   0.2157467  5.654842    1.253396    25.51247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10 372 0.009940603   0.2055296 14.516669    1.898898   110.97682</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        group_cox.p group_ph.p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5  0.024210342  0.2157467</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10 0.009940603  0.2055296</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with group 3 vs 2 only, and produce Schoenfeld residual plot to check PH assumption</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.stage</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">groups.stage</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"II"</span>,<span class="st">"III"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"subset.of.stages.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  ph.assumption.check <span class="op">=</span> <span class="st">"residual.plot"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled II will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create data that will fail PH assumption</span></span></span>
<span class="r-in"><span><span class="va">survtime.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">60</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">40</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survstat.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">survobj.ph</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">survtime.ph</span>, <span class="va">survstat.ph</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">groups.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="fl">100</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">'B'</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">gender.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span>, <span class="fl">200</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">score.ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">200</span>, shape <span class="op">=</span> <span class="fl">20</span>, rate<span class="op">=</span><span class="fl">1</span><span class="op">)</span>; <span class="co"># this is just an arbitrary "continuous" variable</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set some plotting parameters</span></span></span>
<span class="r-in"><span><span class="va">xlimits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">xat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,<span class="fl">25</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with PH assumption checking (warning on plot)</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.ph</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">groups.ph</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gender.ph</span>, <span class="va">score.ph</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"ph.warning.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  ph.assumption.check <span class="op">=</span> <span class="st">"warning.and.plot"</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled A will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue for the following factors: groups, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>SEE BELOW FOR MULTI-POINT HR TABLE:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  1,2 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          n    wald.p global.ph.p   groups2_HR groups2_CI95l groups2_CI95h</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5  200 0.9257696   0.9811706 9.075218e-10    0.00000000           Inf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10 189 0.5495586   0.3630171 6.976591e-01    0.03821815      12.73552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        groups2_cox.p groups2_ph.p gender.phFemale_HR gender.phFemale_CI95l</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5      0.9992556    0.9999996       9.444266e+08            0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10     0.8080423    0.1605790       9.580891e-01            0.05302127</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        gender.phFemale_CI95h gender.phFemale_cox.p gender.phFemale_ph.p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5                    Inf             0.9992635            0.9999997</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10              17.31258             0.9768697            0.1605790</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        score.ph_HR score.ph_CI95l score.ph_CI95h score.ph_cox.p score.ph_ph.p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5    0.9038679      0.6767115       1.207276      0.4937094     0.6737190</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10   0.6567306      0.3716206       1.160579      0.1477958     0.5676549</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in BoutrosLab.utilities::generate.filename(project.stem = paste(gsub(".tiff",     "", filename), "Schoenfeld.residuals", sep = "_"), file.core = names(pvalues.zph)[i],     extension = "tiff", file.date = FALSE):</span> Invalid characters found in: ph.warning.survival.plot_Schoenfeld.residuals</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> Needs to be alphanumeric [a-zA-Z0-9] , dash (-), or dot (.)</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Survival plot with PH assumption checking (switch to logrank test if fails)</span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj.ph</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">groups.ph</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"ph.logrank.survival.plot.tiff"</span>,</span></span>
<span class="r-in"><span>  xlimits <span class="op">=</span> <span class="va">xlimits</span>,</span></span>
<span class="r-in"><span>  xat <span class="op">=</span> <span class="va">xat</span>,</span></span>
<span class="r-in"><span>  ph.assumption.check <span class="op">=</span> <span class="st">"logrank"</span>,</span></span>
<span class="r-in"><span>  resolution <span class="op">=</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled A will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue for the following factors: groups, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.The cox.zph test yielded a small pvalue for the following factors: GLOBAL, so the PH assumption may not be valid. Use a non-parametric test (log-rank) to get the pvalue. If Cox modelling is desired, use stratified model or time-varying covariate. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>SEE BELOW FOR MULTI-POINT HR TABLE:</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Loglik converged before variable  1 ; coefficient may be infinite. </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          n    wald.p global.ph.p     group_HR group_CI95l group_CI95h</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5  200 0.9988558   0.9999993 1.711635e-09  0.00000000         Inf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10 189 0.9875313   0.1573246 1.022347e+00  0.06394662    16.34478</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        group_cox.p group_ph.p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time5    0.9988558  0.9999993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time10   0.9875313  0.1573246</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>The cox.zph test yielded a small pvalue so the PH assumption may not be valid. The statistical method was changed from 'cox' to 'logrank', because the logrank test is nonparametric. Talk to Paul if you are not sure what to do.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example with and without stratification</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">151</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">survtime</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">10</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">survstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">survobj</span> <span class="op">&lt;-</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">survtime</span>, <span class="va">survstat</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'A'</span>,<span class="st">'B'</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Male'</span>,<span class="st">'Female'</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>,<span class="st">"Female"</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Young'</span>,<span class="st">'MiddleAged'</span>,<span class="st">'Old'</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Young'</span>, <span class="st">'MiddleAged'</span>, <span class="st">'Old'</span><span class="op">)</span><span class="op">)</span>;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"surv.plot.no.stratification.tiff"</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">gender</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled A will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">BoutrosLab.plotting.survival</span><span class="fu">::</span><span class="fu">create.km.plot</span><span class="op">(</span></span></span>
<span class="r-in"><span>  survival.object <span class="op">=</span> <span class="va">survobj</span>,</span></span>
<span class="r-in"><span>  patient.groups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">groups</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename <span class="op">=</span> <span class="st">"surv.plot.with.stratification.tiff"</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  stratification.factor <span class="op">=</span> <span class="va">gender</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>;</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Note that the risk group labelled A will be used as the baseline risk group. If this is not what is desired, please add a "levels" argument to the factor passed to patient.groups, where the first factor refers to the baseline group</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>contrasts dropped from factor groups</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No TIFF support in this version of R</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Paul Boutros.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

